# Next.js Static Site Configuration for Bluehost
# This file ensures proper serving of static assets

# Enable mod_rewrite
RewriteEngine On

# Set proper MIME types for JavaScript and CSS
<IfModule mod_mime.c>
    AddType application/javascript .js
    AddType text/css .css
    AddType application/json .json
    AddType image/svg+xml .svg
    AddType image/webp .webp
</IfModule>

# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Allow access to next-static directory and all its contents
<IfModule mod_rewrite.c>
    # Allow all files in next-static directory
    RewriteRule ^next-static/ - [L]
</IfModule>

# Fallback for static files - serve with proper headers
<FilesMatch "\.(js|css|json|svg|webp|png|jpg|jpeg|gif|ico|woff|woff2|ttf|eot)$">
    # Set cache headers for static assets
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
    </IfModule>
    
    # Set proper headers
    Header set Cache-Control "public, immutable, max-age=31536000"
    
    # Allow cross-origin requests for fonts
    <IfModule mod_headers.c>
        SetEnvIf Origin "https?://(www\.)?(info\.digitaltrailheads\.com)$" AccessControlAllowOrigin=$0
        Header add Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
    </IfModule>
</FilesMatch>

# Redirect any remaining _next requests to next-static
<IfModule mod_rewrite.c>
    RewriteRule ^_next/(.*)$ /next-static/$1 [R=301,L]
</IfModule>

# Handle Next.js routing for blog pages
<IfModule mod_rewrite.c>
    # Don't rewrite files or directories that exist
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    
    # Handle blog routes
    RewriteRule ^blog/?$ /blog.html [L]
    RewriteRule ^blog/([^/]+)/?$ /blog/$1.html [L]
</IfModule>

# Security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
</IfModule> 